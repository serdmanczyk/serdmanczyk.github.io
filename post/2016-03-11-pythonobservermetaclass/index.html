<!DOCTYPE html>
<html lang="en-us">
	<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Steven Erdmanczyk Jr.">
<meta name="description" content="software engineer / adventurer">
<meta name="generator" content="Hugo 0.26" />
<title>Python Observer Metaclass</title>
<link rel="shortcut icon" href="http://serdmanczyk.github.io/images/favicon.ico">
<link rel="stylesheet" href="http://serdmanczyk.github.io/css/style.css">
<link rel="stylesheet" href="http://serdmanczyk.github.io/css/highlight.css">



<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">



<link href="http://serdmanczyk.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Steven Erdmanczyk Jr." />


<meta property="og:title" content="Python Observer Metaclass" />
<meta property="og:description" content="A BaseObject.GetTypeMaker().create(&#34;sqare&#34;) peg in a type(&#34;round&#34;, (), {}) hole" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://serdmanczyk.github.io/post/2016-03-11-PythonObserverMetaclass/" />



<meta property="article:published_time" content="2016-03-10T17:24:01-08:00"/>
<meta property="article:modified_time" content="2016-03-10T17:24:01-08:00"/>













<meta itemprop="name" content="Python Observer Metaclass">
<meta itemprop="description" content="A BaseObject.GetTypeMaker().create(&#34;sqare&#34;) peg in a type(&#34;round&#34;, (), {}) hole">


<meta itemprop="dateModified" content="2016-03-10T17:24:01-08:00" />
<meta itemprop="wordCount" content="541">



<meta itemprop="keywords" content="" />

<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Python Observer Metaclass"/>
<meta name="twitter:description" content="A BaseObject.GetTypeMaker().create(&#34;sqare&#34;) peg in a type(&#34;round&#34;, (), {}) hole"/>
<meta name="twitter:site" content="@https://twitter.com/serdmanczyk"/>


    </head>
<body>
    <nav class="main-nav">
	
		<a href='http://serdmanczyk.github.io/'> <span class="arrow">←</span>Home</a>
	

	

	
		<a class="cta" href="http://serdmanczyk.github.io/index.xml">Subscribe</a>
	
</nav>

    <section id="wrapper">
        
        
<article class="post">
    <header>
        <h1>Python Observer Metaclass</h1>
        <h2 class="headline">
        March 10, 2016
        <br>
        
        </h2>
    </header>
    <section id="post-body">
        

<h2 id="why">Why?</h2>

<p>Looking back and grimacing at my Master&rsquo;s thesis code written in the halcyon days of graduate school when I had just started learning Python, I thought it would be a rewarding process to try and re-write it using better coding practices.</p>

<p>I was wrong.</p>

<p>At first I found a few interesting ways to re-architect the code, but when that dust clear I realized I would just be spending hours re-implementing mundane details.  So I decided to scrap and let the dead horse lay.</p>

<p>One thing I got out of the endeavor, though, was I crafted a nifty way to implement an observer class in Python using meta-programming techniques.</p>

<p>If you&rsquo;re familiar with the <a href="http://www.blackwasp.co.uk/gofpatterns.aspx">gang of four</a>, you&rsquo;re familiar with the <a href="http://www.blackwasp.co.uk/Observer.aspx">observer</a> pattern.  The basic principle is objects can subscribe to other object&rsquo;s events and when a particular event happens an object can notify its subscribers.</p>

<p>The thing about gang of four patterns is given different idioms between languages some of the patterns don&rsquo;t translate as gracefully into all languages, or at the least, wouldn&rsquo;t be implemented the same way.  This was a fun endeavor, but I wouldn&rsquo;t reccomend it in the real world.</p>

<p>Regardless, because meta-programming is interesting and fun I thought this endeavour worth sharing at least as another example of Python meta-class mechanics.</p>

<script src="https://gist.github.com/serdmanczyk/6a22cb9868162d0d47bb.js"></script>

<h2 id="what-s-happening">What&rsquo;s happening?</h2>

<p>The functions decorated by <code>observers</code> are given an attribute marking what
they observe.</p>

<p>Since <code>Friend</code>&rsquo;s metaclass is <code>Observer</code> the <code>Observer</code> <code>__call__</code> method intercepts the class creation before <code>Friend</code>&rsquo;s <code>__init__</code> method.</p>

<p>The <code>__call__</code> method on <code>Observer</code> finds all functions marked as observers and stores them in a dictionary alongside their parameter specs and adds this dictionary as an attribute to the class.  It then adds a function <code>receive</code> which is the observers receive method used by communicating classes and function to pass messages.</p>

<p><code>__call__</code> calls <code>Super</code> with the modified <code>cls</code>, which invokes <code>Friend</code>&rsquo;s <code>__init__</code> method, continuing our normal program.</p>

<p>Anytime receive is called, it&rsquo;s passed a parameter of message type (as string), and a **splat of the message into function arguments.  The <code>receive</code> method intelligently maps the message arguments to the functions arg spec, and invokes the mapped receiving function.</p>

<p>In a real use case the instance generated from Friend would be passed as a subscriber to the object needing to publish state, which would notify Friend when actions happen.  My intention with this class was my parser for XBee messages in my thesis code would notify the handler classes when messages were received, and the observing handlers would route messages accordingly via this pattern.</p>

<h2 id="a-square-peg-in-a-round-hole">A Square Peg in a Round Hole</h2>

<p>One fallacy with this method is that <em>only the first</em> instance of <code>Friend</code> will receive messages since <code>__call__</code> only builds the observing function map on creation of the class, so latter instance&rsquo;s won&rsquo;t get their functions mapped.  There are a couple of solutions to mitigate this, but they call on more code and more rabbit holes to dig down.  At this point I felt the problem further vindicated my hunch that trying to create a generalized meta-class for the observer pattern in Python was fitting a square peg in a round hole.  Nonetheless, it was a fun opportunity to mess with meta-classes and get a better idea of what uses they have.</p>

    </section>
</article>

<footer id="post-meta" class="clearfix">
    
    <img class="avatar" src="http://serdmanczyk.github.io/images/avatar.png">
    <div>
        <span class="dark">Steven Erdmanczyk Jr.</span>
        <span>Software Developer</span>
    </div>
    
    <section id="sharing">
        <a class="twitter" href="https://twitter.com/intent/tweet?text=http%3a%2f%2fserdmanczyk.github.io%2fpost%2f2016-03-11-PythonObserverMetaclass%2f - Python%20Observer%20Metaclass "><span class="icon-twitter"> tweet</span></a>

<a class="facebook" href="#" onclick="
    window.open(
      'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
      'facebook-share-dialog',
      'width=626,height=436');
    return false;"><span class="icon-facebook-rect"> Share</span>
</a>

    </section>
</footer>

<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "serdmanczyk" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<ul id="post-list" class="archive readmore">
    <h3>Read more</h3>

    
    
    
        <li>
            <a href="/post/2017-08-24-Bifrost/">Bifröst - a queryable in-process worker queue (golang)<aside class="dates">Aug 24 2017</aside></a>
        </li>
    
        <li>
            <a href="/post/2016-10-14-GoFullstackApp/">A fullstack Go &#43; ReactJS App deployed with Docker<aside class="dates">Oct 23 2016</aside></a>
        </li>
    
        <li>
            <a href="/post/2015-06-11-Python_XBee_Sounds_Library/">Notes and Chords using Python<aside class="dates">Jun 11 2015</aside></a>
        </li>
    
        <li>
            <a href="/post/2015-02-12-moving-to-seattle-hows-the-weather/">Moving to Seattle, How&#39;s the Weather? (graphs!)<aside class="dates">Feb 25 2015</aside></a>
        </li>
    
        <li>
            <a href="ClassAtttendanceApp/">Online Class Attendance App using Flask/MongoDB<aside class="dates">Jun 18 2014</aside></a>
        </li>
    
        <li>
            <a href="XBeeAPI-PythonArduino-Tutorial/">XBee API Mode Tutorial Using Python and Arduino<aside class="dates">Jun 1 2014</aside></a>
        </li>
    
        <li>
            <a href="BlogStarts/">Developer Blog Begins<aside class="dates">May 29 2014</aside></a>
        </li>
    
        <li>
            <a href="MSEEThesis/">Master&#39;s Thesis<aside class="dates">May 28 2014</aside></a>
        </li>
    
</ul>



        <footer id="footer">
    
        <div id="social">

	
	
    <a class="symbol" href="mailto:serdmanczyk@gmail.com">
        <i class="fa fa-envelope"></i>
    </a>
    
    <a class="symbol" href="https://github.com/serdmanczyk">
        <i class="fa fa-github"></i>
    </a>
    
    <a class="symbol" href="https://www.linkedin.com/in/sjerdmanczykjr/">
        <i class="fa fa-linkedin"></i>
    </a>
    
    <a class="symbol" href="https://stackoverflow.com/users/2406040/serdmanczyk">
        <i class="fa fa-stack-overflow"></i>
    </a>
    
    <a class="symbol" href="https://twitter.com/serdmanczyk">
        <i class="fa fa-twitter"></i>
    </a>
    


</div>

    
    <p class="small">
    
        © Copyright 2017 Steven Erdmanczyk Jr.
    
    </p>
</footer>

    </section>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="http://serdmanczyk.github.io/js/main.js"></script>
<script src="http://serdmanczyk.github.io/js/highlight.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-51048910-1', 'auto');
ga('send', 'pageview');
</script>


</body>
</html>
